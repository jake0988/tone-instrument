{"ast":null,"code":"import { connect } from \"../core/context/ToneAudioNode\";\nimport { Param } from \"../core/context/Param\";\nimport { optionsFromArguments } from \"../core/util/Defaults\";\nimport { OneShotSource } from \"../source/OneShotSource\";\n/**\n * Wrapper around the native fire-and-forget ConstantSource.\n * Adds the ability to reschedule the stop method.\n * @category Signal\n */\n\nexport class ToneConstantSource extends OneShotSource {\n  constructor() {\n    super(optionsFromArguments(ToneConstantSource.getDefaults(), arguments, [\"offset\"]));\n    this.name = \"ToneConstantSource\";\n    /**\n     * The signal generator\n     */\n\n    this._source = this.context.createConstantSource();\n    const options = optionsFromArguments(ToneConstantSource.getDefaults(), arguments, [\"offset\"]);\n    connect(this._source, this._gainNode);\n    this.offset = new Param({\n      context: this.context,\n      convert: options.convert,\n      param: this._source.offset,\n      units: options.units,\n      value: options.offset,\n      minValue: options.minValue,\n      maxValue: options.maxValue\n    });\n  }\n\n  static getDefaults() {\n    return Object.assign(OneShotSource.getDefaults(), {\n      convert: true,\n      offset: 1,\n      units: \"number\"\n    });\n  }\n  /**\n   * Start the source node at the given time\n   * @param  time When to start the source\n   */\n\n\n  start(time) {\n    const computedTime = this.toSeconds(time);\n    this.log(\"start\", computedTime);\n\n    this._startGain(computedTime);\n\n    this._source.start(computedTime);\n\n    return this;\n  }\n\n  _stopSource(time) {\n    this._source.stop(time);\n  }\n\n  dispose() {\n    super.dispose();\n\n    if (this.state === \"started\") {\n      this.stop();\n    }\n\n    this._source.disconnect();\n\n    this.offset.dispose();\n    return this;\n  }\n\n}","map":{"version":3,"mappings":"AAAA,SAASA,OAAT,QAAwB,+BAAxB;AACA,SAASC,KAAT,QAAsB,uBAAtB;AAEA,SAASC,oBAAT,QAAqC,uBAArC;AACA,SAASC,aAAT,QAAoD,yBAApD;AAUA;;;;;;AAKA,OAAM,MAAOC,kBAAP,SAAwED,aAAxE,CAA0H;EAmB/HE;IAEC,MAAMH,oBAAoB,CAACE,kBAAkB,CAACE,WAAnB,EAAD,EAAmCC,SAAnC,EAA8C,CAAC,QAAD,CAA9C,CAA1B;IAnBQ,YAAe,oBAAf;IAET;;;;IAGQ,eAAU,KAAKC,OAAL,CAAaC,oBAAb,EAAV;IAeP,MAAMC,OAAO,GAAGR,oBAAoB,CAACE,kBAAkB,CAACE,WAAnB,EAAD,EAAmCC,SAAnC,EAA8C,CAAC,QAAD,CAA9C,CAApC;IAEAP,OAAO,CAAC,KAAKW,OAAN,EAAe,KAAKC,SAApB,CAAP;IAEA,KAAKC,MAAL,GAAc,IAAIZ,KAAJ,CAAU;MACvBO,OAAO,EAAE,KAAKA,OADS;MAEvBM,OAAO,EAAEJ,OAAO,CAACI,OAFM;MAGvBC,KAAK,EAAE,KAAKJ,OAAL,CAAaE,MAHG;MAIvBG,KAAK,EAAEN,OAAO,CAACM,KAJQ;MAKvBC,KAAK,EAAEP,OAAO,CAACG,MALQ;MAMvBK,QAAQ,EAAER,OAAO,CAACQ,QANK;MAOvBC,QAAQ,EAAET,OAAO,CAACS;IAPK,CAAV,CAAd;EASA;;EAEiB,OAAXb,WAAW;IACjB,OAAOc,MAAM,CAACC,MAAP,CAAclB,aAAa,CAACG,WAAd,EAAd,EAA2C;MACjDQ,OAAO,EAAE,IADwC;MAEjDD,MAAM,EAAE,CAFyC;MAGjDG,KAAK,EAAE;IAH0C,CAA3C,CAAP;EAKA;EAED;;;;;;EAIAM,KAAK,CAACC,IAAD,EAAY;IAChB,MAAMC,YAAY,GAAG,KAAKC,SAAL,CAAeF,IAAf,CAArB;IACA,KAAKG,GAAL,CAAS,OAAT,EAAkBF,YAAlB;;IACA,KAAKG,UAAL,CAAgBH,YAAhB;;IACA,KAAKb,OAAL,CAAaW,KAAb,CAAmBE,YAAnB;;IACA,OAAO,IAAP;EACA;;EAESI,WAAW,CAACL,IAAD,EAAe;IACnC,KAAKZ,OAAL,CAAakB,IAAb,CAAkBN,IAAlB;EACA;;EAEDO,OAAO;IACN,MAAMA,OAAN;;IACA,IAAI,KAAKC,KAAL,KAAe,SAAnB,EAA8B;MAC7B,KAAKF,IAAL;IACA;;IACD,KAAKlB,OAAL,CAAaqB,UAAb;;IACA,KAAKnB,MAAL,CAAYiB,OAAZ;IACA,OAAO,IAAP;EACA;;AArE8H","names":["connect","Param","optionsFromArguments","OneShotSource","ToneConstantSource","constructor","getDefaults","arguments","context","createConstantSource","options","_source","_gainNode","offset","convert","param","units","value","minValue","maxValue","Object","assign","start","time","computedTime","toSeconds","log","_startGain","_stopSource","stop","dispose","state","disconnect"],"sources":["/Users/jakeg/code/tone-instrument/node_modules/tone/Tone/signal/ToneConstantSource.ts"],"sourcesContent":["import { connect } from \"../core/context/ToneAudioNode\";\nimport { Param } from \"../core/context/Param\";\nimport { Seconds, Time, UnitMap, UnitName } from \"../core/type/Units\";\nimport { optionsFromArguments } from \"../core/util/Defaults\";\nimport { OneShotSource, OneShotSourceOptions } from \"../source/OneShotSource\";\n\nexport interface ToneConstantSourceOptions<TypeName extends UnitName> extends OneShotSourceOptions {\n\tconvert: boolean;\n\toffset: UnitMap[TypeName];\n\tunits: TypeName;\n\tminValue?: number;\n\tmaxValue?: number;\n}\n\n/**\n * Wrapper around the native fire-and-forget ConstantSource.\n * Adds the ability to reschedule the stop method.\n * @category Signal\n */\nexport class ToneConstantSource<TypeName extends UnitName = \"number\"> extends OneShotSource<ToneConstantSourceOptions<TypeName>> {\n\n\treadonly name: string = \"ToneConstantSource\";\n\n\t/**\n\t * The signal generator\n\t */\n\tprivate _source = this.context.createConstantSource();\n\n\t/**\n\t * The offset of the signal generator\n\t */\n\treadonly offset: Param<TypeName>;\n\n\t/**\n\t * @param  offset   The offset value\n\t */\n\tconstructor(offset: UnitMap[TypeName]);\n\tconstructor(options?: Partial<ToneConstantSourceOptions<TypeName>>);\n\tconstructor() {\n\n\t\tsuper(optionsFromArguments(ToneConstantSource.getDefaults(), arguments, [\"offset\"]));\n\t\tconst options = optionsFromArguments(ToneConstantSource.getDefaults(), arguments, [\"offset\"]);\n\n\t\tconnect(this._source, this._gainNode);\n\n\t\tthis.offset = new Param({\n\t\t\tcontext: this.context,\n\t\t\tconvert: options.convert,\n\t\t\tparam: this._source.offset,\n\t\t\tunits: options.units,\n\t\t\tvalue: options.offset,\n\t\t\tminValue: options.minValue,\n\t\t\tmaxValue: options.maxValue,\n\t\t});\n\t}\n\n\tstatic getDefaults(): ToneConstantSourceOptions<any> {\n\t\treturn Object.assign(OneShotSource.getDefaults(), {\n\t\t\tconvert: true,\n\t\t\toffset: 1,\n\t\t\tunits: \"number\" as UnitName,\n\t\t});\n\t}\n\n\t/**\n\t * Start the source node at the given time\n\t * @param  time When to start the source\n\t */\n\tstart(time?: Time): this {\n\t\tconst computedTime = this.toSeconds(time);\n\t\tthis.log(\"start\", computedTime);\n\t\tthis._startGain(computedTime);\n\t\tthis._source.start(computedTime);\n\t\treturn this;\n\t}\n\n\tprotected _stopSource(time?: Seconds): void {\n\t\tthis._source.stop(time);\n\t}\n\n\tdispose(): this {\n\t\tsuper.dispose();\n\t\tif (this.state === \"started\") {\n\t\t\tthis.stop();\n\t\t}\n\t\tthis._source.disconnect();\n\t\tthis.offset.dispose();\n\t\treturn this;\n\t}\n}\n"]},"metadata":{},"sourceType":"module"}